<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://unpkg.com/pixi.js@7.x/dist/pixi.min.js"></script>
    <!-- <script type="text/javascript" src="./artists.json"></script> -->
    <script type="module" src="./index.js"></script>
  </head>

  <body>
    <style>
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
    </style>
    <script defer>


      const horizontalPadding = 50;
      const verticalPadding = 50;
      mainBackgroundColor = 0xffffff;
      const boxColor = 0x555555;
      //The App
      const app = new PIXI.Application({
        width: 1920,
        height: 1080,
        backgroundColor: 0xffffff,
      });

      // app.resizeTo = window;
      //Fix, or at least improve blurry text
      PIXI.settings.ROUND_PIXELS = true;
      const stage = app.stage;
      const view = app.view;

      //Add view to the document
      document.body.appendChild(app.view);

      const artistProfile = new PIXI.Container();
      // Addign the view here for the moment. Might help with loading problems.
      app.stage.addChild(artistProfile);
      const carouselMaskLeft = new PIXI.Graphics();
      const carouselMaskRight = new PIXI.Graphics();
      carouselMaskLeft.beginFill(mainBackgroundColor);
      carouselMaskLeft.drawRect(0, app.view.height / 2, 250, app.view.height);
      carouselMaskRight.beginFill(mainBackgroundColor);
      carouselMaskRight.drawRect(
        app.view.width - 250,
        app.view.height / 2,
        250,
        app.view.height
      );

      const artistPhoto = new PIXI.Graphics();
      artistPhoto.beginFill(boxColor);
      artistPhoto.drawRect(0, 0, 450, 650);

      // Anchoring to the top left of the screen
      artistPhoto.x = horizontalPadding;
      artistPhoto.y = verticalPadding;

      const infoBox = new PIXI.Container();
      const infoBoxBackground = new PIXI.Graphics();
      infoBoxBackground.beginFill(boxColor);
      infoBoxBackground.drawRect(0, 0, 1300, 650);
      const artistName = new PIXI.Text("Isabella Rivera", {
        fontFamily: "sans-serif",
        fontWeight: "bold",
        fontSize: 32,
        fill: 0x000000,
      });
      const artistLocation = new PIXI.Text("New York City, USA", {
        fontFamily: "sans-serif",
        fontWeight: "bold",
        fontSize: 32,
        fill: 0x000000,
      });
      const artistMedium = new PIXI.Text("Oil painting", {
        fontFamily: "sans-serif",
        fontWeight: "bold",
        fontSize: 32,
        fill: 0x000000,
      });

      const artistQRCode = new PIXI.Container();
      const artistDescription = new PIXI.Text(
        "Isabella Rivera's art is an exploration of the juxtaposition between the urban and the natural world. In the heart of New York City, she finds inspiration in the city's towering skyscrapers and bustling streets, which she blends seamlessly with the serene beauty of nature. Her oil paintings aim to capture the essence of this harmony by using vivid colors and intricate details to depict the dynamic interplay between these two seemingly contrasting realms. Through her work, she hopes to remind viewers that even within the concrete jungle, there is a place for the organic and the tranquil.",
        {
          fontFamily: "sans-serif",
          fontWeight: "bold",
          wordWrap: true,
          wordWrapWidth: 800,
          fontSize: 32,
          fill: 0x000000,
        }
      );
      artistName.x = 50;
      artistName.y = 50;
      artistLocation.x = 50;
      artistLocation.y = 100;
      artistMedium.x = 50;
      artistMedium.y = 150;
      artistDescription.x = 400;
      artistDescription.y = 50;

      infoBox.addChild(infoBoxBackground);
      infoBox.addChild(artistName);
      infoBox.addChild(artistLocation);
      infoBox.addChild(artistMedium);
      infoBox.addChild(artistQRCode);
      infoBox.addChild(artistDescription);

      // Anchoring to the top right of the screen
      infoBox.x = app.view.width - infoBox.width - horizontalPadding;
      infoBox.y = verticalPadding;

      const imageGallery = new PIXI.Container();




      async function generateGallery() {
        // Placeholder to allocate space while the images load, since we can't just do things in a set order apparently. 
        const imageGalleryPlaceholder = new PIXI.Graphics();
        imageGallery.addChild(imageGalleryPlaceholder);
        imageGalleryPlaceholder.beginFill(boxColor);
        imageGalleryPlaceholder.drawRect(0, 0, 150, 250);
        const images = [
          "./img/gallery/mountains.jpg",
          "./img/gallery/prism.jpg",
          "./img/gallery/wind.jpg",
          "./img/gallery/dog.jpg",
          "./img/gallery/trees.jpg",
        ];
        await PIXI.Assets.load(images).then(() => {
          imageGallery.children.pop(0);
          // This way to make this work seems pretty cursed, but whatever. 
          let count = 0;
          images.forEach(async (path) => {
            const texture = await PIXI.Assets.load(path);
            const sprite = await new PIXI.Sprite(texture);
            sprite.height = 250;
            sprite.width = (250 / sprite.texture.baseTexture.height) * sprite.width;
            imageGallery.addChild(sprite);
            if (count != 0) {
              sprite.x = imageGallery.children[count - 1].x + imageGallery.children[count - 1].width + 50;
            } else {
              sprite.x = 0;
            }

            count += 1;
          });

        });
      }
      generateGallery();
      // Anchoring to the bottom left of the screen with extra padding to allow for a back button
      imageGallery.x = horizontalPadding + 200;
      imageGallery.y = app.view.height - imageGallery.height - verticalPadding;

      // Making the gallery click+draggable horizontally
      imageGallery.interactive = true;
      imageGallery.dragging = false;
      imageGallery.on("pointerdown", (e) => {
        imageGallery.calculateBounds();
        imageGallery.offsetX = imageGallery.x - e.global.x;
        imageGallery.offsetY = imageGallery.y - e.global.y;
        imageGallery.dragging = true;
      });
      imageGallery.on("pointermove", (e) => {
        if (imageGallery.dragging) {

          imageGallery.x = e.global.x + imageGallery.offsetX;
          //Check constraints
          if (imageGallery.width > .75 * app.view.width) {
            if (imageGallery.x < -imageGallery.width + 0.75 * app.view.width) {
              //Right limit
              imageGallery.x = -imageGallery.width + 0.75 * app.view.width;
            } else if (imageGallery.x > 0.25 * app.view.width) {
              //Left limit
              imageGallery.x = 0.25 * app.view.width;
            }
          } else {
            imageGallery.x = horizontalPadding + 200;
          }


          // if (slide.x < 0) slide.x = 0;
          // Check value
          // this.value = slide.x / track.width;
        }
      });

      imageGallery.on("pointerup", (e) => {
        imageGallery.dragging = false;
      });
      imageGallery.on("pointerupoutside", (e) => {
        imageGallery.dragging = false;
      });

      artistProfile.addChild(imageGallery);
      artistProfile.addChild(carouselMaskLeft);
      artistProfile.addChild(carouselMaskRight);
      artistProfile.addChild(artistPhoto);
      artistProfile.addChild(infoBox);
      //This should probably be done through the director later.

    </script>
  </body>

</html>